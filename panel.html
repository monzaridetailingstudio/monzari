<!DOCTYPE html><html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel Admin - Monzari Club</title>
  <link rel="stylesheet" href="styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet" />
  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Playfair Display', serif;
      color: white;
      background: url('images/imagenlogin-panel.jpg') no-repeat center center/cover;
    }
    .main-container {
      display: flex;
      flex-direction: row;
      gap: 40px;
      padding: 30px 20px;
      min-height: 100vh;
      background-color: rgba(0, 0, 0, 0.8);
    }
    .sidebar {
      width: 200px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .contenido-principal {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .contenido-seccion {
      display: none;
      background-color: #111;
      padding: 20px;
      border-radius: 10px;
      width: 100%;
    }
    .btn {
      padding: 10px 15px;
      background: linear-gradient(90deg, #f3e07a, #b68d2c);
      color: black;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    .gold-title {
      font-size: 2rem;
      margin-bottom: 1.5rem;
      background: linear-gradient(90deg, #f3e07a, #b68d2c);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-transform: uppercase;
      font-weight: bold;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: #f3e07a;
    }
    .form-group input {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 6px;
    }
    .tarjeta-vehiculo {
      background: #222;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(255,255,255,0.1);
      color: #f3e07a;
      display: flex;
      flex-direction: column;
    }
    .acciones {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      justify-content: flex-end;
    }
    @media (max-width: 768px) {
      .main-container {
        flex-direction: column;
      }
      .sidebar {
        flex-direction: row;
        justify-content: space-around;
        width: 100%;
        margin-bottom: 20px;
      }
      .acciones {
        justify-content: center;
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <main class="main-container">
    <div class="sidebar">
      <button class="btn" onclick="mostrarSeccion('inicio')">Inicio</button>
      <button class="btn" onclick="mostrarSeccion('nuevoVehiculo')">Cargar nuevo veh√≠culo</button>
      <button class="btn" onclick="mostrarSeccion('actualizarDocumentacion')">Actualizar documentaci√≥n</button>
      <button class="btn" onclick="mostrarSeccion('nuevoBeneficio')">Cargar nuevo beneficio</button>
      <button class="btn" onclick="mostrarSeccion('actualizarBeneficio')">Actualizar beneficio</button>
      <button class="btn" onclick="mostrarSeccion('nuevoTurno')">Cargar nuevo turno</button>
      <button class="btn" onclick="mostrarSeccion('Turnos')">Turnos</button>
    </div>
    <div class="contenido-principal">
      <div id="inicio" class="contenido-seccion" style="display:block">
        <h2 class="gold-title">Hola Gonzalo, bienvenido nuevamente</h2>
        <p>Seleccion√° una opci√≥n del panel lateral para comenzar.</p>
      </div>
      <div id="nuevoVehiculo" class="contenido-seccion">
        <h2 class="gold-title">Cargar nuevo veh√≠culo</h2>
        <form id="formNuevoVehiculo">
          <div class="form-group"><label for="uid">UID del cliente</label><input type="text" id="uid" required /></div>
          <div class="form-group"><label for="nombre">Nombre del due√±o</label><input type="text" id="nombre" required /></div>
          <div class="form-group"><label for="email">Email</label><input type="email" id="email" required /></div>
          <div class="form-group"><label for="marca">Marca</label><input type="text" id="marca" required /></div>
          <div class="form-group"><label for="modelo">Modelo</label><input type="text" id="modelo" required /></div>
          <div class="form-group"><label for="patente">Patente</label><input type="text" id="patente" required /></div>
          <div class="form-group"><label for="color">Color</label><input type="text" id="color" placeholder="Ej: Negro - C√≥digo XYZ" required /></div>
          <div class="form-group"><label for="pdfUrl">Link del documento PDF (Drive)</label><input type="url" id="pdfUrl" placeholder="Peg√° ac√° el link de Drive" required /></div>
          <button type="submit" class="btn">Guardar</button>
        </form>
      </div>
      <div id="actualizarDocumentacion" class="contenido-seccion">
        <h2 class="gold-title">Actualizar documentaci√≥n</h2>
        <div class="form-group">
          <input type="text" id="buscador" placeholder="Buscar por nombre, patente, modelo, etc..." />
        </div>
        <div id="listaVehiculos"></div>
      </div>

      <div id="nuevoBeneficio" class="contenido-seccion">
        <h2 class="gold-title">Cargar nuevo beneficio</h2>
        <form id="formNuevoBeneficio">
          <div class="form-group">
            <label for="uidBeneficio">UID del cliente</label>
            <input type="text" id="uidBeneficio" required />
          </div>
          <div class="form-group">
            <label for="nombreBeneficio">Nombre completo</label>
            <input type="text" id="nombreBeneficio" required />
          </div>
          <div class="form-group">
            <label for="emailBeneficio">Email</label>
            <input type="email" id="emailBeneficio" required />
          </div>
          <div class="form-group">
            <label for="descuentoBeneficio">Porcentaje de descuento</label>
            <input type="number" id="descuentoBeneficio" placeholder="Ej: 10" required />
          </div>
          <div class="form-group">
            <label for="servicioBeneficio">Servicio en descuento</label>
            <input type="text" id="servicioBeneficio" placeholder="Ej: Lavado Premium" required />
          </div>
          <div class="form-group">
            <label for="fechaFinalizacion">Fecha de finalizaci√≥n</label>
            <input type="date" id="fechaFinalizacion" required />
          </div>
          <button type="submit" class="btn">Guardar</button>
        </form>
      </div>

      <div id="actualizarBeneficio" class="contenido-seccion">
        <h2 class="gold-title">Actualizar beneficios</h2>
        <div class="form-group">
          <input type="text" id="buscadorBeneficio" placeholder="Buscar por nombre, email, servicio..." />
        </div>
        <div id="listaBeneficios"></div>
      </div>

      <div id="nuevoTurno" class="contenido-seccion">
        <h2 class="gold-title">Cargar nuevo turno</h2>
        <form id="formNuevoTurno">
          <div class="form-group">
            <label for="nombreTurno">Nombre del due√±o</label>
            <input type="text" id="nombreTurno" required />
          </div>
          <div class="form-group">
            <label for="emailTurno">Email</label>
            <input type="email" id="emailTurno" required />
          </div>
          <div class="form-group">
            <label for="telefonoTurno">N√∫mero de contacto (WhatsApp)</label>
            <input type="tel" id="telefonoTurno" required />
          </div>
          <div class="form-group">
            <label for="marcaTurno">Marca</label>
            <input type="text" id="marcaTurno" required />
          </div>
          <div class="form-group">
            <label for="modeloTurno">Modelo</label>
            <input type="text" id="modeloTurno" required />
          </div>
          <div class="form-group">
            <label for="patenteTurno">Patente</label>
            <input type="text" id="patenteTurno" required />
          </div>
          <div class="form-group">
            <label for="colorTurno">Color</label>
            <input type="text" id="colorTurno" required />
          </div>
          <div class="form-group">
            <label for="fechaTurno">Fecha</label>
            <input type="date" id="fechaTurno" required />
          </div>
          <div class="form-group">
            <label for="horaTurno">Horario</label>
            <input type="time" id="horaTurno" required />
          </div>
          <button type="submit" class="btn">Cargar Turno</button>
        </form>
      </div>

      <div id="Turnos" class="contenido-seccion">
        <h2 class="gold-title">Turnos</h2>
        <div id="calendario"></div>
      </div>
    </div>
  </main>
  <script>
    function mostrarSeccion(id) {
      const secciones = document.querySelectorAll('.contenido-seccion');
      secciones.forEach(sec => sec.style.display = 'none');
      document.getElementById(id).style.display = 'block';
    }
  </script>

  <!-- Firebase + Firestore -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs,
      addDoc,
      doc,
      setDoc,
      updateDoc,
      deleteDoc
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDy7vpjCRM3btGVthbHT5q0GmucM50fQso",
      authDomain: "monzariclub.firebaseapp.com",
      projectId: "monzariclub",
      storageBucket: "monzariclub.appspot.com",
      messagingSenderId: "806224561650",
      appId: "1:806224561650:web:e7b25afbcb51238928576b"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // L√≥gica para cargar veh√≠culos (misma que ya ten√≠as)
    // L√≥gica para beneficios (submit, editar, eliminar)
    // L√≥gica para actualizar veh√≠culos
    // Estas funciones se mantienen id√©nticas a como ya las ten√≠as

    // Asegurar que al hacer clic en la opci√≥n de beneficios, cargue los datos
    document.querySelector("button[onclick=\"mostrarSeccion('actualizarDocumentacion')\"]")
      .addEventListener("click", () => {
        mostrarSeccion('actualizarDocumentacion');
        cargarVehiculos();
      });

    document.querySelector("button[onclick=\"mostrarSeccion('actualizarBeneficio')\"]")
      .addEventListener("click", () => {
        mostrarSeccion('actualizarBeneficio');
        cargarBeneficios();
      });
  </script>

  <!-- FullCalendar -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      let calendarEl = document.getElementById('calendario');
      let calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        height: 'auto',
        locale: 'es',
        events: obtenerTurnos(),
        eventClick: function(info) {
          mostrarMenuTurno(info.event);
        }
      });
      calendar.render();

      document.getElementById('formNuevoTurno').addEventListener('submit', function (e) {
        e.preventDefault();

        let nuevoTurno = {
          id: Date.now().toString(),
          title: document.getElementById('nombreTurno').value,
          start: document.getElementById('fechaTurno').value + 'T' + document.getElementById('horaTurno').value,
          extendedProps: {
            email: document.getElementById('emailTurno').value,
            telefono: document.getElementById('telefonoTurno').value,
            marca: document.getElementById('marcaTurno').value,
            modelo: document.getElementById('modeloTurno').value,
            patente: document.getElementById('patenteTurno').value,
            color: document.getElementById('colorTurno').value
          }
        };

        guardarTurno(nuevoTurno);
        calendar.addEvent(nuevoTurno);
        alert('‚úÖ Turno cargado con √©xito.');
        this.reset();
      });

      function guardarTurno(turno) {
        let turnos = JSON.parse(localStorage.getItem('turnos')) || [];
        turnos.push(turno);
        localStorage.setItem('turnos', JSON.stringify(turnos));
      }

      function obtenerTurnos() {
        return JSON.parse(localStorage.getItem('turnos')) || [];
      }

      function mostrarMenuTurno(evento) {
        let turno = evento.extendedProps;
        let nombre = evento.title;
        let telefono = turno.telefono.replace(/\D/g, '');
        let mensaje = Hola ${nombre}, tu veh√≠culo ya se encuentra listo para retirar.;
        let link = https://wa.me/54${telefono}?text=${encodeURIComponent(mensaje)};

        let opciones = `
          <div style="padding:1em; background:#fff; border-radius:10px;">
            <h3>Turno: ${nombre}</h3>
            <p><b>Veh√≠culo:</b> ${turno.marca} ${turno.modelo} (${turno.color})</p>
            <p><b>Patente:</b> ${turno.patente}</p>
            <p><b>Tel√©fono:</b> ${turno.telefono}</p>
            <a href="${link}" target="_blank" class="btn">üì© Enviar mensaje por WhatsApp</a>
            <br><br>
            <button onclick="eliminarTurno('${evento.id}')" class="btn" style="background:red;">üóë Eliminar turno</button>
          </div>
        `;

        let ventana = document.createElement('div');
        ventana.innerHTML = opciones;
        Object.assign(ventana.style, {
          position: 'fixed',
          top: '50%',
          left: '50%',
          transform: 'translate(-50%, -50%)',
          background: '#000000aa',
          padding: '2em',
          borderRadius: '10px',
          zIndex: 1000
        });

        let fondo = document.createElement('div');
        Object.assign(fondo.style, {
          position: 'fixed',
          top: 0,
          left: 0,
          width: '100vw',
          height: '100vh',
          background: '#00000099',
          zIndex: 999
        });

        fondo.onclick = () => {
          document.body.removeChild(fondo);
          document.body.removeChild(ventana);
        };

        document.body.appendChild(fondo);
        document.body.appendChild(ventana);
      }

      window.eliminarTurno = function (idTurno) {
        if (!confirm('¬øSeguro que quer√©s eliminar este turno?')) return;
        let turnos = JSON.parse(localStorage.getItem('turnos')) || [];
        let nuevosTurnos = turnos.filter(t => t.id !== idTurno);
        localStorage.setItem('turnos', JSON.stringify(nuevosTurnos));
        location.reload();
      }
    });
  </script>
</body>
</html>
